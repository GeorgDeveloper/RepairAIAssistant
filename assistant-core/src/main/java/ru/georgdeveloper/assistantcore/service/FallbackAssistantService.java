package ru.georgdeveloper.assistantcore.service;

import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.stereotype.Service;

/**
 * Fallback —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–ª—É—á–∞–µ–≤ –∫–æ–≥–¥–∞ AI –æ—Ç–∫–ª—é—á–µ–Ω (ai.enabled=false)
 * –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–∞–∑–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM –∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
 */
@Service
@Slf4j
@ConditionalOnProperty(name = "ai.enabled", havingValue = "false", matchIfMissing = false)
public class FallbackAssistantService {

    /**
     * –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ AI
     */
    public String processQuery(String userQuery) {
        log.info("–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ fallback —Å–µ—Ä–≤–∏—Å (AI –æ—Ç–∫–ª—é—á–µ–Ω): {}", userQuery);
        
        if (userQuery == null || userQuery.trim().isEmpty()) {
            return "‚ùì –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å.";
        }
        
        String lowerQuery = userQuery.toLowerCase();
        
        // –ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –±–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
        if (lowerQuery.contains("–ø—Ä–∏–≤–µ—Ç") || lowerQuery.contains("–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π")) {
            return "üëã –ü—Ä–∏–≤–µ—Ç! –Ø –±–∞–∑–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–µ–º–æ–Ω—Ç—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.\n\n" +
                   "‚ö†Ô∏è AI —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã.\n" +
                   "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.";
        }
        
        if (lowerQuery.contains("–∫—Ç–æ —Ç—ã") || lowerQuery.contains("—á—Ç–æ —Ç—ã")) {
            return "ü§ñ –Ø –±–∞–∑–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–µ–º–æ–Ω—Ç—É –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.\n\n" +
                   "‚ö†Ô∏è AI —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã.\n" +
                   "–î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.";
        }
        
        // –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Ä–µ–º–æ–Ω—Ç–µ
        if (containsAny(lowerQuery, "–∫–∞–∫ –ø–æ—á–∏–Ω–∏—Ç—å", "–∫–∞–∫ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å", "—Ä–µ–º–æ–Ω—Ç", "–ø–æ–ª–æ–º–∫–∞", "–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç")) {
            return "üîß **–ë–∞–∑–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–º–æ–Ω—Ç—É:**\n\n" +
                   "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è\n" +
                   "2Ô∏è‚É£ –û—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≤–∏–¥–∏–º—ã—Ö –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π\n" +
                   "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤\n" +
                   "4Ô∏è‚É£ –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫\n" +
                   "5Ô∏è‚É£ –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏\n\n" +
                   "‚ö†Ô∏è **–î–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.**";
        }
        
        // –û—Ç–≤–µ—Ç—ã –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
        if (containsAny(lowerQuery, "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "—Å–∫–æ–ª—å–∫–æ", "—Ç–æ–ø", "–∞–Ω–∞–ª–∏–∑", "–¥–∞–Ω–Ω—ã–µ")) {
            return "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**\n\n" +
                   "‚ö†Ô∏è AI –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.\n\n" +
                   "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤:\n" +
                   "‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã\n" +
                   "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞\n" +
                   "‚Ä¢ –°–≤—è–∂–∏—Ç–µ—Å—å —Å –æ—Ç–¥–µ–ª–æ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è";
        }
        
        // –û–±—â–∏–π –æ—Ç–≤–µ—Ç
        return "ü§ñ **–ë–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã**\n\n" +
               "‚ö†Ô∏è AI —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã.\n\n" +
               "**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**\n" +
               "‚Ä¢ –ë–∞–∑–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–º–æ–Ω—Ç—É\n" +
               "‚Ä¢ –û–±—â–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é\n" +
               "‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤\n\n" +
               "**–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –ø–æ–º–æ—â–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫:**\n" +
               "üìû –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É\n" +
               "üìß –û—Ç–¥–µ–ª—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è\n" +
               "üìã –†—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è";
    }
    
    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å—Ç—Ä–æ–∫–∞ –ª—é–±–æ–µ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
     */
    private boolean containsAny(String text, String... keywords) {
        for (String keyword : keywords) {
            if (text.contains(keyword)) {
                return true;
            }
        }
        return false;
    }
}